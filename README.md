# EasyView - macOS 图片预览器

一个功能强大、性能优异的 macOS 图片预览应用，使用 SwiftUI 构建。

## 主要特性

### 🖼️ 图片浏览
- ✅ 支持打开单个或多个图片文件
- ✅ **智能文件夹浏览**：打开单个图片时，自动加载同文件夹下的所有图片
- ✅ 支持选择整个文件夹，自动加载所有图片
- ✅ 支持格式：JPG, JPEG, PNG, GIF, HEIC, WebP, TIFF, BMP
- ✅ 按文件名自动排序
- ✅ 自动定位到用户选择的图片位置

### 🔍 缩放功能
- ✅ 触控板双指捏合手势缩放
- ✅ 触控板双指上下滑动缩放
- ✅ 鼠标滚轮缩放
- ✅ 以光标位置为中心进行缩放
- ✅ 双击图片重置缩放

### 🎮 导航控制
- ✅ 点击左右箭头按钮切换图片
- ✅ 键盘左右方向键切换
- ✅ 悬停动画效果

### ⚡ 性能优化
- ✅ 图片缓存机制（NSCache）
- ✅ 异步加载图片
- ✅ 预加载左右相邻图片
- ✅ 平滑的弹簧动画

### 🎨 用户体验
- ✅ 拖拽平移查看图片细节
- ✅ 显示当前图片索引 (1/10)
- ✅ 黑色背景配半透明控制按钮
- ✅ 详细的调试日志输出

## 使用方法

### 打开图片
1. 点击左上角的文件夹图标 📁
2. 选择方式：
   - **单个图片**：应用会自动加载该图片所在文件夹的所有图片，并定位到你选择的图片
   - **多个图片**：加载选中的所有图片及其所在文件夹的其他图片
   - **整个文件夹**：加载文件夹中的所有图片
3. 使用左右箭头或方向键浏览文件夹中的所有图片

### 缩放图片
- **触控板**：双指捏合或双指上下滑动
- **鼠标**：滚动滚轮
- **重置**：双击图片

### 浏览图片
- **鼠标**：点击左右两侧的大箭头按钮
- **键盘**：按左右方向键 ← →

### 查看细节
- 缩放后，按住鼠标拖拽可以平移查看图片不同部分

## 技术实现

### 核心技术栈
- SwiftUI (macOS)
- AppKit (NSView, NSEvent)
- Combine (状态管理)

### 关键实现
1. **滚轮事件捕获**：使用 `NSEvent.addLocalMonitorForEvents` 和 `scrollWheel` 方法双重保证
2. **手势识别**：SwiftUI `MagnificationGesture` 和 `DragGesture`
3. **图片缓存**：基于 `NSCache` 的智能缓存策略
4. **异步加载**：使用 `DispatchQueue` 后台加载，不阻塞 UI

## 调试信息

运行应用时，Xcode 控制台会输出详细的调试信息：

- 🎯 滚轮事件捕获
- 📍 滚动位置和范围检测
- 🔄 缩放数值变化
- 📁 文件加载状态
- ⬅️➡️ 导航操作

## 系统要求

- macOS 12.0 或更高版本
- Xcode 14.0 或更高版本

## 构建运行

### ⚠️ 重要：配置文件夹访问权限

**首次构建前，必须在 Xcode 中配置权限！** 否则应用无法访问 Downloads、Pictures 等文件夹。

详细配置步骤请查看：**[XCODE_SETUP.md](XCODE_SETUP.md)**

快速配置：
1. 打开 Xcode 项目
2. 选择 target → "Signing & Capabilities"
3. 添加 "App Sandbox" capability
4. 勾选：User Selected File、Downloads Folder、Pictures Folder
5. 设置 Entitlements 文件路径：`easyView/easyView.entitlements`

### 构建命令

```bash
# 克隆项目
cd /Users/zhangtengfei/Desktop/code/easyView

# 在 Xcode 中打开
open easyView.xcodeproj

# 或使用命令行构建
xcodebuild -scheme easyView build
```

## 文件结构

```
easyView/
├── easyView/
│   ├── ContentView.swift      # 主视图和所有功能实现
│   ├── ImageCache.swift        # 图片缓存管理
│   ├── easyViewApp.swift       # 应用入口
│   └── Assets.xcassets/        # 资源文件
├── easyView.xcodeproj/         # Xcode 项目文件
└── README.md                   # 本文档
```

## 常见问题

### Q: 滚轮缩放不响应？
A: 
1. 确保应用窗口已激活（点击窗口）
2. 查看控制台是否有 "🎯 Scroll event captured!" 日志
3. 尝试点击图片区域再滚动

### Q: 无法切换到下一张图片？
A: 
1. 确保已通过"打开"按钮加载了图片
2. 查看底部的图片计数显示（如 "1/10"）
3. 检查控制台的 "previous/next" 日志输出
4. 即使只打开一张图片，应用也会自动加载同文件夹的所有图片

### Q: 打开单个图片后，为什么显示的图片数量比我想的多？
A: 
- 这是**智能功能**！当你打开单个图片时，应用会自动扫描该图片所在的文件夹
- 这样你就可以用左右箭头浏览整个文件夹，无需手动选择所有图片
- 应用会自动定位到你选择的图片，方便继续浏览

### Q: 为什么打开图片后只显示 "1/1"，无法切换到其他图片？
A: 
- 这通常是 **macOS 沙盒权限限制**导致的
- 某些系统文件夹（如 Downloads、Desktop、Documents）需要额外权限
- **解决方案**：
  1. **配置权限**（推荐）：按照 [XCODE_SETUP.md](XCODE_SETUP.md) 配置文件夹访问权限
  2. 直接选择整个文件夹（而不是单个文件）
  3. 或者将图片移动到没有权限限制的文件夹
  4. 控制台会提示：`⚠️ 只加载了选中的图片（可能是文件夹权限限制）`

### Q: 如何授予应用访问 Downloads 文件夹的权限？
A:
1. **在 Xcode 中配置**（开发阶段）：
   - 查看 [XCODE_SETUP.md](XCODE_SETUP.md) 完整配置指南
   - 添加 App Sandbox 和相应的文件夹权限
   
2. **用户授权**（运行时）：
   - 首次访问 Downloads 或 Pictures 文件夹时
   - macOS 会自动弹出权限请求对话框
   - 点击"允许"即可

3. **手动管理权限**：
   - 系统设置 → 隐私与安全性 → 文件和文件夹
   - 找到 EasyView 并勾选需要的文件夹

### Q: 图片加载缓慢？
A: 
- 大图片会异步加载，首次加载会有延迟
- 后续切换会从缓存加载，速度会很快
- 应用会预加载左右相邻图片以提升体验

## 后续改进方向

- [ ] 支持更多图片格式
- [ ] 添加图片信息显示（尺寸、大小、格式）
- [ ] 支持图片旋转
- [ ] 幻灯片播放模式
- [ ] 全屏模式
- [ ] 图片编辑功能（裁剪、滤镜）

## 许可证

本项目仅供学习和个人使用。

## 作者

张腾飞 - 2025年10月16日
